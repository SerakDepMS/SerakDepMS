name: Update Random Video

on:
  schedule:
    # Se ejecuta a la medianoche UTC todos los dÃ­as
    - cron: '0 0 * * *'
  # TambiÃ©n se ejecuta manualmente desde GitHub
  workflow_dispatch:
  # Se ejecuta cuando se actualizan los videos
  push:
    paths:
      - 'videos/**'

jobs:
  update-readme:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v3
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
    
    - name: Generate random number
      id: random
      run: |
        # Genera un nÃºmero aleatorio entre 1 y 8
        RANDOM_NUM=$(( (RANDOM % 8) + 1 ))
        echo "random_number=$RANDOM_NUM" >> $GITHUB_OUTPUT
        echo "Selected video: video$RANDOM_NUM.mp4"
    
    - name: Update README with random video
      run: |
        RANDOM_NUM=${{ steps.random.outputs.random_number }}
        # Crea el nuevo cÃ³digo del video
        NEW_VIDEO="<div align=\"center\">\n  <!-- Video animado aleatorio -->\n  <video src=\"https://raw.githubusercontent.com/SerakDepMS/Serakdep-MS-Clan/main/videos/video${RANDOM_NUM}.mp4\" width=\"180\" autoplay loop muted playsinline></video>\n</div>"
        
        # Reemplaza la secciÃ³n del video en el README
        # Asumiendo que el README tiene marcadores especiales
        awk -v new_video="$NEW_VIDEO" '
        /<!-- START_RANDOM_VIDEO -->/ {
            print $0
            print new_video
            skip = 1
            next
        }
        /<!-- END_RANDOM_VIDEO -->/ {
            skip = 0
        }
        !skip' README.md > README_temp.md
        
        mv README_temp.md README.md
    
    - name: Commit and push changes
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        git add README.md
        git commit -m "ðŸŽ¬ Actualizado video aleatorio - $(date +'%Y-%m-%d %H:%M:%S')" || echo "No hay cambios"
        git push